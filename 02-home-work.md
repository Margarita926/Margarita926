# Модуль 2 · Практичне завдання 1  
## Теоретична підготовка

## 1. Огляд архітектури та точки інтеграції
- External System → Controller
- Controller(Validate Format & auth)
- Controller → External System(responce 200)
- Controller → RMQ Producer→ RabbitMQ → RMQ Consumer
- EndUserAppSender ↔ Account DB(Lookup client config)
- EndUserAppSender → Client Deployment → EndUserAppSender

Критичні точки інтеграції
External System → Controller 
RabbitMQ → Consumer
Consumer ↔ Account DB
EndUserAppSender → Client Deployment 

## 2. Бізнес-вимоги та Performance SLO
очікування щодо роботи сервісу з точки зору бізнесу та користувача
критичні нефункціональні вимоги, що впливають на продуктивність

### 2.1 Бізнес-вимоги
- данні повинні відображатись в ріал-таймі
- конверсії не повиині губитись
- не повинні створюватись дублі на повторні виплати
- система має переживати піки трафіку
- при падінні інтеграції повинен бути retry та події мають бути доставлені пізніше
  
### 2.2 Набір SLO

| Метрика          | Значення                              |Обґрунтування
| ---------------- | ------------------------------------- |-------------------------
| Latency          | < 4 сек                               |час обробки webhook(орієнтир UX реального часу) це критично важливо, якщо> кількох секунд то починається retry
| Availability     | 99.9% uptime                          |на скільки сервіс доступний, втрати подій = втрата грошей
| Throughput       | min 500 events/sec;max 2000 events/sec|скільки подій/сек (без деградації latency)при піку трафіку події стають у чергу на 20 хвилин.Орієнтир- пікове навантаження ×3                    
| Error Rate       | 0.1%(не валідації)                    |% 5хх помилок,може привести до скритої втрати даних,  неконсистентні дані      
| Delivery Success | 99.99% (через retry)                  |% доставлених подій,робота над надійністю
| Time to Recover  | 2-5 хв                                |як швидко відновлюється після падіння,чим довше відновлення→ тим більша втрата данних
| Freshness        | ≤ 15 сек                              |як швидко дані з’являються в системі, UX досвід
       


## 3. Сценарій взаємодії з командою
Марго- лідер тестування(стратегія, комунікація)
Ігор- інженер середовища(шарить в інфраструктурі)
Марго- розробка сценаріїв(налаштування інструментів і розробка сценаріїв)
Ніл- робудова моніторінгу в графані
Марго- QA інженер

Я почну не з метрик, а з ризикованості подій бо webhook сервіси ламаються не через навантаження, а від неправильних очікувань (формування причинно- наслідкових звязків у бізнеса що перформенс це важливо)
якщо webhook приходить за 20 секунд -3d paty робить retry -> з’являються дублікати -> неправильні виплати-> втрата грошей

**потрібно дізнатися в бізнеса:**
- (В результаті з’являється класифікація подій Critical,Important,Optional)
- які події фінансові (lead, purchase, payout)
- які події інформаційні (notification, status update)
- чи допустима затримка, дублікати, втрата

Після цього узгоджуємо: SLO (що гарантуємо) SLI (що реально міряємо) SLA (який еталон)

**Розробникам:**
- які події ідемпотентні
- що є success  доставка чи 200 OK?
- де формується retry у нас чи у партнера
- який максимальний payload
- webhook sync чи через чергу

**DevOps**
- чи є rate limit
- autoscaling по CPU чи по queue lag
- чи є dead letter queue
- як виглядає деградація  throttling чи падіння
- чи синхронне логування

**Продакт**

- що гірше: затримка чи дублікати
- чи можна відправляти пізніше але гарантовано
- як швидко очікуємо подію
- які є піки (розсилки, імпорт, cron, маркетинг)

**Як узгоджую сценарії навантаження** моделюємо поведінку
 
- Steady load нормальний трафік
- Spike партнер підключився
- Burst імпорт / розсилка
- Slow consumer партнер відповідає 20-30 сек
- Retry storm партнер почав повторювати
- Backlog recovery підняли сервіс після падіння

**ескалюю проблеми**
фіксую метрику->показую бізнес impact-> пропоную варіанти вирішення(accept, mitigate,block release)

**Робота з інцидентами**
вимкнути ретраї-> перевірити queue lag-> визначити: втрата чи затримка -> увімкнути buffering / replay



## 4. Висновки
Webhook-сервіс повинен гарантувати доставку фінансово значимих подій без втрати даних, забезпечувати їх відображення в майже в реальному часі та витримувати 
пікові навантаження. Основними нефункціональними вимогами є надійність, ідемпотентність, масштабованість та спостережуваність. 
QA формує гіпотези ризиків, визначає критерії перевірки та ініціює роботу інфраструктури й моніторингу. 
Відповідальний по середовищу забезпечує керованість системи, відповідальний по моніторингу спостережуваність, після чого QA валідовує реальну поведінку сервісу. Таким чином 
команда працює від перевірюваних властивостей системи.
